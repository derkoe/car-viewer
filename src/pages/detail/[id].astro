---
import "../../styles/global.css";

import type { Vehicle } from "../../types";

export const prerender = false;

const { id } = Astro.params;
const res = await fetch(
  `https://www.dasweltauto.at/api/locales/de_AT/vehicles/${id}/detail`
);
const vehicle = (await res.json()) as Vehicle;
---

<div class="bg-gray-50 min-h-screen py-6 px-2 md:px-0">
  <div
    class="max-w-5xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col md:flex-row"
  >
    <!-- Image section -->
    <div
      class="md:w-2/5 bg-gradient-to-br from-orange-100 to-orange-200 flex flex-col items-center justify-center p-6 relative"
    >
      <div
        class="absolute top-4 left-4 bg-black/70 text-white text-xs px-3 py-1 rounded font-semibold"
      >
        Prompt verfügbar!
      </div>
      <img
        src={vehicle.overview.imageUrls[0]}
        alt={vehicle.overview.header}
        class="rounded-xl shadow-lg w-full h-56 object-contain bg-white"
      />
      <div class="text-xs text-gray-400 mt-2 text-right w-full">
        Bild: {vehicle.overview.header}
      </div>
    </div>
    <!-- Details section -->
    <div class="md:w-3/5 p-6 flex flex-col gap-4">
      <div
        class="flex flex-col md:flex-row md:items-center md:justify-between gap-2"
      >
        <div>
          <h1 class="text-2xl font-bold text-gray-800">
            {vehicle.overview.header}
          </h1>
          <p class="text-gray-500 text-lg">{vehicle.overview.subHeader}</p>
        </div>
        <div class="text-right">
          <div class="text-2xl font-bold text-orange-600">
            {
              vehicle.overview.price.toLocaleString("de-AT", {
                style: "currency",
                currency: "EUR",
              })
            }
          </div>
          <div class="text-xs text-gray-400 line-through">
            {
              vehicle.overview.newSalesListPrice
                ? vehicle.overview.newSalesListPrice.toLocaleString("de-AT", {
                    style: "currency",
                    currency: "EUR",
                  })
                : ""
            }
          </div>
          <div class="text-xs text-gray-500 mt-1">Angebot der Woche</div>
        </div>
      </div>
      <div class="flex flex-wrap gap-2 text-sm text-gray-700">
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.powerKw} kW/{vehicle.technicalData.powerPs} PS
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {
            vehicle.technicalData.initialRegistrationDate
              ?.toString()
              .slice(0, 7)
          }
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.mileage.toLocaleString()} km
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.fuelText}
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.combinedConsumption} l/100km
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.co2Emission} g/km
        </div>
        <div class="bg-gray-100 rounded px-2 py-1">
          {vehicle.technicalData.emissionClassText}
        </div>
      </div>
      <div class="flex flex-col md:flex-row gap-4 mt-2">
        <div class="flex-1">
          <div class="font-semibold text-gray-700 mb-1">Fahrzeugdaten</div>
          <table class="w-full text-sm text-gray-600">
            <tbody>
              <tr
                ><td class="py-1">Farbe:</td><td class="py-1"
                  >{vehicle.technicalData.colorText}</td
                ></tr
              >
              <tr
                ><td class="py-1">Erstzulassung:</td><td class="py-1"
                  >{
                    vehicle.technicalData.initialRegistrationDate
                      ?.toString()
                      .slice(0, 7)
                  }</td
                ></tr
              >
              <tr
                ><td class="py-1">Kilometerstand:</td><td class="py-1"
                  >{vehicle.technicalData.mileage.toLocaleString()} km</td
                ></tr
              >
              <tr
                ><td class="py-1">Leistung:</td><td class="py-1"
                  >{vehicle.technicalData.powerKw} kW/{
                    vehicle.technicalData.powerPs
                  } PS</td
                ></tr
              >
              <tr
                ><td class="py-1">Kraftstoff:</td><td class="py-1"
                  >{vehicle.technicalData.fuelText}</td
                ></tr
              >
              <tr
                ><td class="py-1">Verbrauch:</td><td class="py-1"
                  >{vehicle.technicalData.combinedConsumption} l/100km</td
                ></tr
              >
              <tr
                ><td class="py-1">CO₂-Emission:</td><td class="py-1"
                  >{vehicle.technicalData.co2Emission} g/km</td
                ></tr
              >
              <tr
                ><td class="py-1">Abgasnorm:</td><td class="py-1"
                  >{vehicle.technicalData.emissionClassText}</td
                ></tr
              >
              <tr
                ><td class="py-1">Antrieb:</td><td class="py-1"
                  >{vehicle.technicalData.driveText}</td
                ></tr
              >
              <tr
                ><td class="py-1">Türen:</td><td class="py-1"
                  >{vehicle.technicalData.doors}</td
                ></tr
              >
              <tr
                ><td class="py-1">Sitze:</td><td class="py-1"
                  >{vehicle.technicalData.seats}</td
                ></tr
              >
              <tr
                ><td class="py-1">Hubraum:</td><td class="py-1"
                  >{vehicle.technicalData.motorCapacity} cm³</td
                ></tr
              >
              <tr
                ><td class="py-1">Karosserie:</td><td class="py-1"
                  >{vehicle.technicalData.bodyText}</td
                ></tr
              >
              <tr
                ><td class="py-1">Eigengewicht:</td><td class="py-1"
                  >{vehicle.technicalData.weightNet} kg</td
                ></tr
              >
              <tr
                ><td class="py-1">Gesamtgewicht:</td><td class="py-1"
                  >{vehicle.technicalData.weightGross} kg</td
                ></tr
              >
              <tr
                ><td class="py-1">Getriebeart:</td><td class="py-1"
                  >{vehicle.technicalData.gearTypeText}</td
                ></tr
              >
            </tbody>
          </table>
        </div>
        <div class="flex-1 flex flex-col gap-2">
          <div class="font-semibold text-gray-700 mb-1">Händler</div>
          <div class="bg-gray-100 rounded p-2">
            <div class="font-bold">
              {vehicle.dealerDetail.vehicleLocation.name}
            </div>
            <div class="text-sm">
              {vehicle.dealerDetail.vehicleLocation.street}, {
                vehicle.dealerDetail.vehicleLocation.postalCode
              }
              {vehicle.dealerDetail.vehicleLocation.city}
            </div>
          </div>
          <a
            href={`tel:${vehicle.overview.dealerPhoneNumber}`}
            class="mt-2 inline-block bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded shadow text-center"
            >Händler kontaktieren</a
          >
          <div class="text-xs text-gray-400 mt-2">
            Reservierungsgebühr: <span class="font-semibold text-gray-700"
              >EUR 100,-</span
            >
          </div>
          <button
            class="w-full bg-orange-400 hover:bg-orange-500 text-white font-bold py-2 rounded mt-1"
            >Reservieren</button
          >
        </div>
      </div>
    </div>
  </div>
</div>
